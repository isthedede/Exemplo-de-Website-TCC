<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - Frutas Frescas</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .perfil-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 50px;
        }

        main {
            margin-top: 100px;
            padding-top: 50px;
            padding-bottom: 50px;
        }

        .perfil-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .perfil-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: #2ecc71;
        }

        .perfil-info {
            flex: 1;
            margin-left: 20px;
        }

        .perfil-info h2 {
            margin: 0;
            color: #333;
        }

        .perfil-info p {
            color: #666;
            margin: 5px 0;
        }

        .perfil-acoes {
            display: flex;
            gap: 10px;
        }

        .perfil-tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #666;
            background: none;
            border: none;
            outline: none;
            font-weight: bold;
        }

        .perfil-tab:hover {
            color: #2ecc71;
        }

        .perfil-tab.active {
            color: #2ecc71;
            border-bottom: 2px solid #2ecc71;
        }

        .perfil-content {
            margin-top: 20px;
        }

        .perfil-section {
            display: none;
            padding: 20px 0;
        }

        .perfil-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .botao-acao {
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .botao-primario {
            background-color: #2ecc71;
        }

        .botao-primario:hover {
            background-color: #27ae60;
        }

        .botao-perigo {
            background-color: #e74c3c;
        }

        .botao-perigo:hover {
            background-color: #c0392b;
        }

        .pedidos-lista {
            list-style-type: none;
            padding: 0;
        }

        .pedido-item {
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .pedido-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .favoritos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .favorito-item {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .favorito-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .favorito-imagem {
            height: 150px;
            overflow: hidden;
        }

        .favorito-imagem img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .favorito-info {
            padding: 10px;
        }

        .favorito-info h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }

        .favorito-preco {
            font-weight: bold;
            color: #2ecc71;
        }
    </style>
</head>
<body>
    <header role="banner">
        <nav role="navigation" aria-label="Menu principal">
            <div class="logo">
                <h1>Frutas Frescas</h1>
            </div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Buscar produtos..." aria-label="Buscar produtos">
                <button class="search-button" aria-label="Buscar">
                    <i class="fas fa-search"></i>
                </button>
                <div class="search-results">
                    <!-- Resultados da busca serão inseridos aqui dinamicamente -->
                </div>
            </div>
            <ul class="nav-links">
                <li><a href="index.html" aria-label="Página inicial">Início</a></li>
                <li><a href="produtos.html" aria-label="Ver produtos">Produtos</a></li>
                <li><a href="sobre.html" aria-label="Sobre nós">Sobre</a></li>
                <li><a href="contato.html" aria-label="Contato">Contato</a></li>
            </ul>
            <a href="perfil.html" class="perfil-btn" aria-label="Minha conta">
                <i class="fas fa-user"></i>
            </a>
            <a href="carrinho.html" class="carrinho-btn" aria-label="Abrir carrinho">
                <i class="fas fa-shopping-cart"></i>
                <span class="carrinho-contador">0</span>
            </a>
        </nav>
    </header>

    <main role="main">
        <div class="perfil-container">
            <div class="perfil-header">
                <div class="perfil-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="perfil-info">
                    <h2 id="usuario-nome">Nome do Usuário</h2>
                    <p id="usuario-email">usuario@email.com</p>
                    <p>Membro desde <span id="usuario-data">01/01/2024</span></p>
                </div>
                <button class="botao-acao botao-perigo" id="logout-btn">Sair</button>
            </div>

            <div class="perfil-nav">
                <button class="perfil-tab active" data-target="dados">Meus Dados</button>
                <button class="perfil-tab" data-target="pedidos">Meus Pedidos</button>
                <button class="perfil-tab" data-target="favoritos">Meus Favoritos</button>
                <button class="perfil-tab" data-target="senha">Alterar Senha</button>
            </div>

            <div class="perfil-content">
                <div class="perfil-section active" id="dados-section">
                    <h3>Meus Dados</h3>
                    <form id="form-dados">
                        <div class="form-group">
                            <label for="nome">Nome Completo</label>
                            <input type="text" id="nome" required>
                        </div>
                        <div class="form-group">
                            <label for="email">E-mail</label>
                            <input type="email" id="email" required>
                        </div>
                        <button type="submit" class="botao-acao botao-primario">Salvar Alterações</button>
                    </form>
                </div>

                <div class="perfil-section" id="pedidos-section">
                    <h3>Meus Pedidos</h3>
                    <ul class="pedidos-lista" id="pedidos-lista">
                        <!-- A lista de pedidos será preenchida dinamicamente -->
                        <li class="pedido-item">
                            <div class="pedido-header">
                                <span>Pedido #12345</span>
                                <span>01/04/2024</span>
                            </div>
                            <div class="pedido-produtos">
                                <p>Maçãs Vermelhas x2, Bananas Prata x1</p>
                            </div>
                            <div class="pedido-total">
                                <p><strong>Total:</strong> R$ 35,70</p>
                            </div>
                            <div class="pedido-status">
                                <span class="status entregue">Entregue</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="perfil-section" id="favoritos-section">
                    <h3>Meus Favoritos</h3>
                    <div class="favoritos-grid" id="favoritos-grid">
                        <!-- A grade de favoritos será preenchida dinamicamente -->
                        <div class="favorito-item">
                            <div class="favorito-imagem">
                                <img src="https://www.infoescola.com/wp-content/uploads/2021/09/maca-red-1102078_1920-1536x1017.jpg" alt="Maçãs Vermelhas">
                            </div>
                            <div class="favorito-info">
                                <h3>Maçãs Vermelhas</h3>
                                <p class="favorito-preco">R$ 12,90/kg</p>
                                <button class="botao-acao botao-primario">Comprar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="perfil-section" id="senha-section">
                    <h3>Alterar Senha</h3>
                    <form id="form-senha">
                        <div class="form-group">
                            <label for="senha-atual">Senha Atual</label>
                            <input type="password" id="senha-atual" required>
                        </div>
                        <div class="form-group">
                            <label for="nova-senha">Nova Senha</label>
                            <input type="password" id="nova-senha" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmar-senha">Confirmar Nova Senha</label>
                            <input type="password" id="confirmar-senha" required>
                        </div>
                        <button type="submit" class="botao-acao botao-primario">Atualizar Senha</button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer role="contentinfo">
        <div class="footer-content">
            <div class="footer-section">
                <h3>CATEGORIAS</h3>
                <ul>
                    <li><a href="#">LANÇAMENTOS</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>INFORMAÇÃO</h3>
                <ul>
                    <li><a href="contato.html">Contato</a></li>
                    <li><a href="sobre.html">Quem somos?</a></li>
                    <li><a href="#">Política de Trocas & Devoluções</a></li>
                    <li><a href="#">Termos de Uso</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>ENTRE EM CONTATO</h3>
                <ul>
                    <li>5511987654321</li>
                    <li>+55 11 91234-5678</li>
                    <li>contato@frutas.com</li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Frutas Frescas. Todos os direitos reservados.</p>
            <div class="payment-methods">
                <img src="https://cdn.icon-icons.com/icons2/2341/PNG/512/visa_payment_method_card_icon_142729.png" alt="Visa" height="30">
                <img src="https://d26lpennugtm8s.cloudfront.net/assets/common/img/logos/payment/new_logos_payment/mastercard@2x.png" alt="Mastercard" height="30">
                <img src="https://d26lpennugtm8s.cloudfront.net/assets/common/img/logos/payment/new_logos_payment/amex@2x.png" alt="American Express" height="30">
                <img src="https://d26lpennugtm8s.cloudfront.net/assets/common/img/logos/payment/new_logos_payment/br/elo@2x.png" alt="Elo" height="30">
                <img src="https://cdn.icon-icons.com/icons2/2341/PNG/512/hipercard_payment_method_card_icon_142739.png" alt="Hipercard" height="30">
                <img src="https://logospng.org/download/pix/logo-pix-icone-512.png" alt="PIX" height="30">
            </div>
        </div>
    </footer>

    <script type="module">
        import ModelFactory from './app/factories/ModelFactory.js';
        
        // Obter o modelo de usuário
        const usuarioModel = ModelFactory.createUsuarioModel();
        
        // Verificar se o usuário está logado
        if (!usuarioModel.estaLogado()) {
            // Redirecionar para a página de login
            window.location.href = 'login.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Carregar dados do usuário
            const usuarioAtual = usuarioModel.getUsuarioAtual();
            const dadosCompletos = usuarioModel.getDadosCompletos();
            
            if (usuarioAtual) {
                // Preencher informações do usuário
                document.getElementById('usuario-nome').textContent = usuarioAtual.nome;
                document.getElementById('usuario-email').textContent = usuarioAtual.email;
                
                if (dadosCompletos && dadosCompletos.dataCadastro) {
                    const data = new Date(dadosCompletos.dataCadastro);
                    document.getElementById('usuario-data').textContent = data.toLocaleDateString('pt-BR');
                }
                
                // Preencher formulário de dados
                document.getElementById('nome').value = usuarioAtual.nome;
                document.getElementById('email').value = usuarioAtual.email;
                
                // Carregar pedidos (se houver)
                if (dadosCompletos && dadosCompletos.pedidos && dadosCompletos.pedidos.length > 0) {
                    const pedidosLista = document.getElementById('pedidos-lista');
                    pedidosLista.innerHTML = ''; // Limpar lista
                    
                    dadosCompletos.pedidos.forEach(pedido => {
                        const itemPedido = document.createElement('li');
                        itemPedido.className = 'pedido-item';
                        // Preencher detalhes do pedido
                        // ...
                        pedidosLista.appendChild(itemPedido);
                    });
                } else {
                    document.getElementById('pedidos-lista').innerHTML = '<p>Você ainda não realizou nenhum pedido.</p>';
                }
                
                // Carregar favoritos (se houver)
                if (dadosCompletos && dadosCompletos.favoritos && dadosCompletos.favoritos.length > 0) {
                    const favoritosGrid = document.getElementById('favoritos-grid');
                    favoritosGrid.innerHTML = ''; // Limpar grade
                    
                    dadosCompletos.favoritos.forEach(favorito => {
                        const itemFavorito = document.createElement('div');
                        itemFavorito.className = 'favorito-item';
                        // Preencher detalhes do favorito
                        // ...
                        favoritosGrid.appendChild(itemFavorito);
                    });
                } else {
                    document.getElementById('favoritos-grid').innerHTML = '<p>Você ainda não tem produtos favoritos.</p>';
                }
            }
            
            // Adicionar evento para botão de logout
            document.getElementById('logout-btn').addEventListener('click', function() {
                const resultado = usuarioModel.logout();
                if (resultado.success) {
                    window.location.href = 'login.html';
                }
            });
            
            // Adicionar eventos para as abas
            document.querySelectorAll('.perfil-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remover classe 'active' de todas as abas e seções
                    document.querySelectorAll('.perfil-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.perfil-section').forEach(s => s.classList.remove('active'));
                    
                    // Adicionar classe 'active' à aba clicada e seção correspondente
                    this.classList.add('active');
                    const target = this.getAttribute('data-target');
                    document.getElementById(`${target}-section`).classList.add('active');
                });
            });
            
            // Formulário para atualizar dados
            document.getElementById('form-dados').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nome = document.getElementById('nome').value;
                const email = document.getElementById('email').value;
                
                const resultado = usuarioModel.atualizarDados(nome, email);
                if (resultado.success) {
                    alert(resultado.message);
                    // Atualizar dados exibidos
                    document.getElementById('usuario-nome').textContent = nome;
                    document.getElementById('usuario-email').textContent = email;
                } else {
                    alert(resultado.message);
                }
            });
            
            // Formulário para alterar senha
            document.getElementById('form-senha').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const senhaAtual = document.getElementById('senha-atual').value;
                const novaSenha = document.getElementById('nova-senha').value;
                const confirmarSenha = document.getElementById('confirmar-senha').value;
                
                if (novaSenha !== confirmarSenha) {
                    alert('As senhas não coincidem');
                    return;
                }
                
                const resultado = usuarioModel.atualizarSenha(senhaAtual, novaSenha);
                if (resultado.success) {
                    alert(resultado.message);
                    document.getElementById('form-senha').reset();
                } else {
                    alert(resultado.message);
                }
            });
        });
    </script>
</body>
</html> 